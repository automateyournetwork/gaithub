<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}gaithub{% endblock %}</title>
    <link rel="stylesheet" href="/static/style.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css">
  </head>
  <body>
    <div class="topbar">
      <div style="display: flex; align-items: center; gap: 20px;">
        <div class="brand"><a href="/">gaithub</a></div>
        <div class="nav">
          <a href="/repos">repos</a>
          <a href="/console">console</a>
          <a href="/getting-started">docs</a>
        </div>
      </div>
      <div id="auth-status" class="auth-status">
        <button class="btn btn-sm" onclick="showAuthModal()">Login / Set Token</button>
      </div>
    </div>

    <div class="container">
      {% block content %}{% endblock %}
    </div>

    <div id="auth-modal" class="modal-overlay" style="display:none;">
      <div class="modal-content card">
        <h3>Authentication</h3>
        <p class="muted">Enter your GaitHub Bearer token to enable write actions.</p>
        <input type="password" id="global-token-input" placeholder="gaithub_..." style="width:100%; padding:10px; border-radius:8px; border:1px solid var(--border-color); background:var(--bg-main); color:var(--text-main);">
        <div style="display:flex; gap:10px; margin-top:15px; justify-content: flex-end;">
          <button class="btn btn-outline" onclick="closeAuthModal()">Cancel</button>
          <button class="btn" onclick="saveGlobalToken()">Save Token</button>
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script>
      const TOKEN_KEY = 'gaithub_session_token';
      function getSavedToken() { return localStorage.getItem(TOKEN_KEY); }
      function updateAuthUI() {
        const token = getSavedToken();
        const container = document.getElementById('auth-status');
        if (token) {
          container.innerHTML = `<span class="muted" style="font-size:12px;">Authenticated</span><button class="btn btn-sm btn-outline" onclick="logout()">Logout</button>`;
          document.querySelectorAll('input[name="token"], #token').forEach(el => { el.value = token; });
        } else {
          container.innerHTML = `<button class="btn btn-sm" onclick="showAuthModal()">Login / Set Token</button>`;
        }
      }
      function showAuthModal() { document.getElementById('auth-modal').style.display = 'flex'; }
      function closeAuthModal() { document.getElementById('auth-modal').style.display = 'none'; }
      function saveGlobalToken() {
        localStorage.setItem(TOKEN_KEY, document.getElementById('global-token-input').value.trim());
        toast("Token saved!"); updateAuthUI(); closeAuthModal();
      }
      function logout() { localStorage.removeItem(TOKEN_KEY); location.reload(); }
      function toast(msg) {
        const t = document.createElement("div"); t.textContent = msg; t.className = "toast"; document.body.appendChild(t);
        setTimeout(() => t.remove(), 2000);
      }
      window.addEventListener('DOMContentLoaded', updateAuthUI);
    </script>
  </body>
</html>