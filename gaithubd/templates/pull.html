{% extends "base.html" %}
{% block title %}PR #{{ pr_id }} · {{ owner }}/{{ repo }}{% endblock %}
{% block content %}
  {% set status = pr.get("status","unknown") %}

  <div class="header">
    <h1>PR #{{ pr_id }}: {{ pr.get("title","") }}</h1>
    <a href="/repos/{{ owner }}/{{ repo }}/pulls" class="btn btn-sm btn-outline">All Pull Requests</a>
  </div>

  {% if error %}<div class="card" style="border-color:var(--color-danger); color:var(--color-danger);">{{ error }}</div>{% endif %}
  {% if success %}<div class="card" style="border-color:var(--color-success); color:var(--color-success);">{{ success }}</div>{% endif %}

  <div class="card">
    <div style="display:flex; gap:16px; align-items:center;">
      {% if status == 'open' %}
        <div class="btn btn-sm" style="background: var(--color-success); cursor:default;">{{ status|upper }}</div>
      {% else %}
        <div class="btn btn-sm" style="background: #8250df; cursor:default;">{{ status|upper }}</div>
      {% endif %}
      <div class="muted">By <b>{{ pr.get("author","unknown") }}</b> · {{ pr.get("created_at","") }}</div>
    </div>

    <div class="grid" style="margin-top:24px; border-top:1px solid var(--border-color); padding-top:24px;">
      <div>
        <h3 class="muted" style="font-size:12px; margin-bottom:8px;">SOURCE</h3>
        <strong>{{ pr.get("from",{}).get("owner") }}/{{ pr.get("from",{}).get("repo") }}</strong>
        <div class="muted" style="font-size:12px;">Branch: {{ pr.get("from",{}).get("branch") }}</div>
      </div>
      <div style="text-align:right;">
        <h3 class="muted" style="font-size:12px; margin-bottom:8px;">TARGET</h3>
        <strong>{{ pr.get("to",{}).get("branch", "main") }}</strong>
        <div class="muted" style="font-size:12px;">Base OID: {{ pr.get("base_oid")|truncate(12) }}</div>
      </div>
    </div>
  </div>

  {% if status == "open" %}
    <div class="card" style="border-style: dashed;">
      <h2>Merge</h2>
      <p class="muted">Authentication is auto-filled from your session.</p>
      <form method="post" action="/repos/{{ owner }}/{{ repo }}/pulls/{{ pr_id }}/merge">
        <input type="hidden" name="token" />
        <button class="btn" type="submit" style="background:#8250df;">Confirm Merge</button>
      </form>
    </div>
  {% endif %}
{% endblock %}