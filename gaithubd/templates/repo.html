{% extends "base.html" %}
{% block title %}{{ owner }}/{{ repo }} Â· gaithub{% endblock %}
{% block content %}
  <div class="header">
    <div style="display:flex; flex-direction:column; gap:4px;">
      <h1>{{ owner }}/{{ repo }}</h1>
      <div class="muted">
        {% if updated %}Last updated: {{ updated }}{% else %}No activity yet{% endif %}
      </div>
    </div>
    <div style="display:flex; gap:8px;">
      <a class="btn btn-sm btn-outline" href="/repos/{{ owner }}/{{ repo }}/pulls">
        Pull Requests <span style="background:var(--border-color); padding:0 6px; border-radius:10px; margin-left:4px;">{{ pr_open }}</span>
      </a>
    </div>
  </div>

  <div class="grid" style="margin-top:20px;">
    <div class="card" style="grid-column: 1 / -1;">
      <h2>Branches</h2>
      <div class="list">
        {% for name, oid in heads.items() %}
          <div class="commit-card" style="margin-bottom:8px; padding:10px 16px;">
            <div style="display:flex; align-items:center; gap:12px;">
              <a href="/repos/{{ owner }}/{{ repo }}/tree/{{ name }}" style="font-weight:600;">{{ name }}</a>
              <span class="muted" style="font-family:monospace; font-size:12px;">{{ oid[:8] }}</span>
              {% if name == default_branch %}<span class="btn btn-sm btn-outline" style="font-size:10px; padding:2px 6px;">DEFAULT</span>{% endif %}
            </div>
            {% if name != default_branch %}
              <form method="post" action="/repos/{{ owner }}/{{ repo }}/branches/{{ name }}/delete" style="margin:0;">
                <input type="hidden" name="token" />
                <button class="btn btn-sm btn-outline" style="color:var(--color-danger); border-color:rgba(218,54,51,0.2);" onclick="return confirm('Delete branch {{ name }}?');">Delete</button>
              </form>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    </div>

    <div class="card">
      <h2>Clone Context</h2>
      <div class="muted" style="font-size:12px; margin-bottom:6px;">Terminal Command</div>
      <div style="position:relative;">
        <pre id="clone-cmd" style="background:var(--bg-main); padding:12px; border-radius:8px; font-size:12px;">gait clone {{ clone_url }} --owner {{ owner }} --repo {{ repo }}</pre>
        <button class="btn btn-sm btn-outline" style="position:absolute; right:8px; top:8px;" onclick="copyText('clone-cmd')">Copy</button>
      </div>
    </div>

    <div class="card">
      <h2>Repository Metadata</h2>
      <div style="display:flex; flex-direction:column; gap:8px; font-size:14px;">
        <div style="display:flex; justify-content:space-between;">
          <span class="muted">Visibility</span>
          <span>{{ meta.get("visibility", "public")|capitalize }}</span>
        </div>
        <div style="display:flex; justify-content:space-between;">
          <span class="muted">Objects</span>
          <span>{{ commit_count }} Commits</span>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <h2>Conversation Preview</h2>
    {% if convo|length == 0 %}
      <div class="muted">No conversation data found.</div>
    {% else %}
      <div style="display:flex; flex-direction:column; gap:12px;">
        {% for t in convo[:5] %}
          <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px; border-bottom:1px solid var(--border-color); padding-bottom:12px;">
            <div class="muted" style="font-size:12px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">{{ t.user }}</div>
            <div style="font-size:12px; text-align:right;"><a href="/repos/{{ owner }}/{{ repo }}/turn/{{ t.turn_oid }}">View Details &rarr;</a></div>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </div>

  <div class="card" style="border-color:var(--color-danger); opacity:0.8;">
    <h2 style="color:var(--color-danger);">Danger Zone</h2>
    <p class="muted" style="font-size:13px;">Permanently destroy this repository and all its AI context timelines.</p>
    <form method="post" action="/repos/{{ owner }}/{{ repo }}/delete" style="display:flex; gap:10px; margin-top:15px;">
      <input type="hidden" name="token" />
      <input type="text" name="confirm" placeholder="Type {{ owner }}/{{ repo }} to confirm" required
             style="flex:1; padding:8px; border-radius:8px; border:1px solid var(--border-color); background:var(--bg-main); color:var(--text-main);">
      <button class="btn" style="background:var(--color-danger);" onclick="return confirm('Final warning: Delete everything?');">Delete Repo</button>
    </form>
  </div>
{% endblock %}